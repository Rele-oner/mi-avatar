<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AI Avatar - V33 OVERDRIVE</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Share Tech Mono', monospace; }
        canvas { width: 100vw; height: 100vh; transform: rotateY(180deg); }
        video { display: none; }
        #interface { position: absolute; inset: 20px; border: 1px solid rgba(0, 255, 204, 0.2); pointer-events: none; }
        #log { position: absolute; bottom: 40px; left: 40px; color: #00ffcc; font-size: 10px; line-height: 1.5; text-shadow: 0 0 5px #00ffcc; }
    </style>
</head>
<body>
    <div id="interface"></div>
    <div id="log">
        >> CORE_STATE: OVERDRIVE<br>
        >> NEURAL_SYNC: 100%<br>
        >> FPS_STABLE: <span id="fps">0</span>
    </div>
    <canvas id="out"></canvas>
    <video id="v" playsinline></video>

<script type="module">
    const video = document.getElementById('v');
    const canvas = document.getElementById('out');
    const ctx = canvas.getContext('2d');
    let lastTime = 0;
    let pulse = 0;

    function onResults(res) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // EFECTO DE RASTRO (MOTION BLUR)
        ctx.fillStyle = "rgba(0, 5, 5, 0.2)"; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (res.multiFaceLandmarks && res.multiFaceLandmarks.length > 0) {
            const face = res.multiFaceLandmarks[0];
            pulse = (pulse + 0.1) % (Math.PI * 2);
            const intensity = Math.sin(pulse) * 0.5 + 0.5;

            // 1. MALLA NEURAL (ALTA DENSIDAD)
            ctx.globalCompositeOperation = "screen";
            drawConnectors(ctx, face, FACEMESH_TESSELATION, {
                color: `rgba(0, 255, 204, ${0.1 + intensity * 0.1})`,
                lineWidth: 0.5
            });

            // 2. NÚCLEO SINTÉTICO (OJOS)
            ctx.shadowBlur = 20 + intensity * 20;
            ctx.shadowColor = "#00ffcc";
            [468, 473].forEach(idx => {
                const p = face[idx];
                ctx.fillStyle = "#fff";
                ctx.beginPath();
                ctx.arc(p.x * canvas.width, p.y * canvas.height, 5, 0, 7);
                ctx.fill();
            });

            // 3. CONTORNOS DE ALTA PRECISIÓN
            drawConnectors(ctx, face, FACEMESH_FACE_OVAL, {color: '#00ffcc', lineWidth: 2});
            drawConnectors(ctx, face, FACEMESH_LIPS, {color: '#ffffff', lineWidth: 1});
            
            ctx.shadowBlur = 0;
            ctx.globalCompositeOperation = "source-over";
        }

        const now = performance.now();
        document.getElementById('fps').innerText = Math.round(1000 / (now - lastTime));
        lastTime = now;
    }

    const faceMesh = new FaceMesh({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${f}`});
    faceMesh.setOptions({maxNumFaces: 1, refineLandmarks: true, minDetectionConfidence: 0.6});
    faceMesh.onResults(onResults);
    new Camera(video, {onFrame: async () => {await faceMesh.send({image: video})}, width: 1280, height: 720}).start();
</script>
</body>
</html>
