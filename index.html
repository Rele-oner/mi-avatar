<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AI Avatar - Neural Master v19</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <style>
        body { margin: 0; background: #020202; overflow: hidden; font-family: 'Courier New', monospace; color: #00ffcc; }
        .app-container { display: flex; width: 100vw; height: 100vh; }
        .sidebar { width: 220px; background: rgba(0,0,0,0.9); border-right: 1px solid #1a1a1a; padding: 20px; display: flex; flex-direction: column; gap: 20px; font-size: 11px; }
        .main-view { flex: 1; position: relative; display: flex; }
        canvas { width: 100%; height: 100%; transform: rotateY(180deg); object-fit: contain; }
        video { display: none; }
        .stat-box { border-left: 2px solid currentColor; padding-left: 10px; margin-bottom: 15px; }
        .tag { background: rgba(0,255,204,0.1); padding: 4px; display: inline-block; margin-bottom: 5px; border-radius: 2px; }
        .controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; }
        button { background: transparent; border: 1px solid currentColor; color: inherit; padding: 8px 15px; cursor: pointer; font-family: inherit; transition: 0.2s; }
        button:hover { background: rgba(255,255,255,0.1); }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar" id="sidebar">
            <div class="stat-box">
                <div class="tag">SYSTEM_CORE</div>
                <div>STATUS: ONLINE</div>
                <div>LATENCY: <span id="lat">12ms</span></div>
            </div>
            <div class="stat-box">
                <div class="tag">NEURAL_DYNAMICS</div>
                <div>STABILITY: 98.4%</div>
                <div>EXPRESSION: <span id="expr">CALM</span></div>
            </div>
            <div class="stat-box">
                <div class="tag">HARDWARE_SCAN</div>
                <div>GPU_LOAD: LOW</div>
                <div>STREAM: ACTIVE</div>
            </div>
        </div>
        <div class="main-view">
            <canvas id="c_out"></canvas>
            <video id="vid"></video>
            <div class="controls">
                <button onclick="setTheme('#00ffcc', 'CYAN')">01_CYAN</button>
                <button onclick="setTheme('#ff00ff', 'MAGENTA')">02_OVERDRIVE</button>
                <button onclick="setTheme('#ffaa00', 'AMBER')">03_LEGACY</button>
            </div>
        </div>
    </div>

<script type="module">
    let themeColor = '#00ffcc';
    const canvas = document.getElementById('c_out');
    const ctx = canvas.getContext('2d');
    const video = document.getElementById('vid');

    window.setTheme = (color, name) => {
        themeColor = color;
        document.body.style.color = color;
        document.getElementById('sidebar').style.borderColor = color;
    };

    function onResults(res) {
        const w = canvas.width = video.videoWidth;
        const h = canvas.height = video.videoHeight;
        ctx.clearRect(0, 0, w, h);

        // 1. FONDO: Rejilla técnica
        ctx.strokeStyle = themeColor + '11';
        for(let i=0; i<w; i+=50) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,h); ctx.stroke(); }
        for(let i=0; i<h; i+=50) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(w,i); ctx.stroke(); }

        // 2. LÓGICA DE INTENSIDAD (Mouth & Movement)
        let openMouth = 0;
        if(res.faceLandmarks) {
            openMouth = Math.abs(res.faceLandmarks[13].y - res.faceLandmarks[14].y) * 15;
            document.getElementById('expr').innerText = openMouth > 0.4 ? 'ACTIVE_SCAN' : 'STABLE';
        }

        ctx.save();
        if(openMouth > 0.3) {
            ctx.shadowBlur = 20 * openMouth;
            ctx.shadowColor = themeColor;
        }

        // 3. RENDER AVATAR
        const options = { color: themeColor, lineWidth: 2 };
        if (res.poseLandmarks) drawConnectors(ctx, res.poseLandmarks, POSE_CONNECTIONS, {color: themeColor + '44', lineWidth: 1});
        if (res.faceLandmarks) {
            drawConnectors(ctx, res.faceLandmarks, FACEMESH_FACE_OVAL, options);
            drawConnectors(ctx, res.faceLandmarks, FACEMESH_LIPS, {color: '#fff', lineWidth: 1});
        }
        
        const hands = [res.leftHandLandmarks, res.rightHandLandmarks];
        hands.forEach(h => { if(h) drawConnectors(ctx, h, HAND_CONNECTIONS, {color: '#fff', lineWidth: 1.5}); });

        ctx.restore();
        document.getElementById('lat').innerText = Math.floor(Math.random() * 5 + 10) + 'ms';
    }

    const holistic = new Holistic({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${f}`});
    holistic.setOptions({ modelComplexity: 1, smoothLandmarks: true, minDetectionConfidence: 0.5 });
    holistic.onResults(onResults);

    const camera = new Camera(video, { onFrame: async () => { await holistic.send({image: video}); }, width: 640, height: 480 });
    camera.start();
</script>
</body>
</html>
