<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AI Avatar - Lite Engine</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <style>
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        .canvas-container { position: relative; width: 90vw; height: 80vh; border: 2px solid #1a1a1a; }
        canvas { width: 100%; height: 100%; transform: rotateY(180deg); }
        video { display: none; }
        .loader { position: absolute; top: 10px; left: 10px; color: #00ffcc; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="canvas-container">
        <div class="loader" id="status">INICIALIZANDO MOTOR...</div>
        <video id="input_video"></video>
        <canvas id="output_canvas"></canvas>
    </div>

<script type="module">
    const videoElement = document.getElementById('input_video');
    const canvasElement = document.getElementById('output_canvas');
    const canvasCtx = canvasElement.getContext('2d');
    const status = document.getElementById('status');

    function onResults(results) {
        status.innerText = "SISTEMA ACTIVO";
        canvasElement.width = videoElement.videoWidth;
        canvasElement.height = videoElement.videoHeight;

        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
        
        // Dibujamos el fondo negro
        canvasCtx.fillStyle = '#000';
        canvasCtx.fillRect(0, 0, canvasElement.width, canvasElement.height);

        // 1. CARA (Malla básica para estabilidad)
        if (results.faceLandmarks) {
            drawConnectors(canvasCtx, results.faceLandmarks, FACEMESH_TESSELATION,
                          {color: '#00ffcc33', lineWidth: 0.5});
        }

        // 2. CUERPO (Líneas simples neón)
        if (results.poseLandmarks) {
            drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS,
                          {color: '#00ffcc', lineWidth: 2});
        }

        // 3. MANOS (Puntos neón)
        if (results.leftHandLandmarks) {
            drawConnectors(canvasCtx, results.leftHandLandmarks, HAND_CONNECTIONS,
                          {color: '#ffffff', lineWidth: 1.5});
        }
        if (results.rightHandLandmarks) {
            drawConnectors(canvasCtx, results.rightHandLandmarks, HAND_CONNECTIONS,
                          {color: '#ffffff', lineWidth: 1.5});
        }

        canvasCtx.restore();
    }

    const holistic = new Holistic({locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`;
    }});

    holistic.setOptions({
        modelComplexity: 0, // 0 = Rápido, 1 = Preciso. Bajamos a 0 para asegurar que cargue.
        smoothLandmarks: true,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
    });

    holistic.onResults(onResults);

    const camera = new Camera(videoElement, {
        onFrame: async () => {
            await holistic.send({image: videoElement});
        },
        width: 640,
        height: 480
    });
    camera.start();
</script>
</body>
</html>
