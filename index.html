<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AI Avatar - V36 OMNI</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Share Tech Mono', monospace; }
        canvas { width: 100vw; height: 100vh; transform: rotateY(180deg); filter: contrast(1.1) brightness(1.2); }
        video { display: none; }
        #interface { position: absolute; inset: 0; pointer-events: none; border: 20px solid rgba(0, 255, 204, 0.05); }
        .data-stream { position: absolute; color: rgba(0, 255, 204, 0.2); font-size: 8px; writing-mode: vertical-rl; }
    </style>
</head>
<body>
    <div id="interface"></div>
    <canvas id="out"></canvas>
    <video id="v" playsinline></video>

<script type="module">
    const video = document.getElementById('v');
    const canvas = document.getElementById('out');
    const ctx = canvas.getContext('2d');
    let frame = 0;

    function drawSystemLines(ctx, face) {
        const points = [10, 152, 234, 454]; // Arriba, abajo, izq, der
        ctx.strokeStyle = "rgba(0, 255, 204, 0.1)";
        ctx.lineWidth = 0.5;
        points.forEach(i => {
            const p = face[i];
            ctx.beginPath();
            ctx.moveTo(p.x * canvas.width, p.y * canvas.height);
            ctx.lineTo(i % 2 === 0 ? 0 : canvas.width, i < 100 ? 0 : canvas.height);
            ctx.stroke();
        });
    }

    function onResults(res) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        frame++;

        // Efecto de persistencia retiniana
        ctx.fillStyle = "rgba(0, 5, 5, 0.2)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (res.multiFaceLandmarks && res.multiFaceLandmarks.length > 0) {
            const face = res.multiFaceLandmarks[0];

            // 1. DISTORSIÓN DE HOLOGRAMA (Glitch aleatorio)
            const jitter = Math.random() > 0.95 ? (Math.random() - 0.5) * 10 : 0;
            ctx.translate(jitter, 0);

            // 2. MALLA DE ALTA DENSIDAD CON "LATIDO"
            const pulse = Math.sin(frame * 0.1) * 5;
            ctx.shadowBlur = 10 + pulse;
            ctx.shadowColor = "#00ffcc";
            
            drawConnectors(ctx, face, FACEMESH_TESSELATION, {
                color: "rgba(0, 255, 204, 0.2)", lineWidth: 0.5
            });

            // 3. NÚCLEO FOTÓNICO (Ojos con "sangrado" de luz)
            [468, 473].forEach(idx => {
                const p = face[idx];
                ctx.fillStyle = "#fff";
                ctx.shadowBlur = 30;
                ctx.beginPath();
                ctx.arc(p.x * canvas.width, p.y * canvas.height, 5, 0, 7);
                ctx.fill();
                
                // Anillos de enfoque
                ctx.strokeStyle = "rgba(255, 255, 255, 0.2)";
                ctx.beginPath();
                ctx.arc(p.x * canvas.width, p.y * canvas.height, 15 + pulse, 0, 7);
                ctx.stroke();
            });

            // 4. ESTRUCTURA CRÍTICA
            drawConnectors(ctx, face, FACEMESH_FACE_OVAL, {color: "#00ffcc", lineWidth: 2});
            drawConnectors(ctx, face, FACEMESH_LIPS, {color: "#fff", lineWidth: 1});

            drawSystemLines(ctx, face);
            ctx.setTransform(1, 0, 0, 1, 0, 0); // Reset glitch
        }
    }

    const faceMesh = new FaceMesh({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${f}`});
    faceMesh.setOptions({maxNumFaces: 1, refineLandmarks: true, minDetectionConfidence: 0.6});
    faceMesh.onResults(onResults);
    new Camera(video, {onFrame: async () => {await faceMesh.send({image: video})}, width: 1280, height: 720}).start();
</script>
</body>
</html>
