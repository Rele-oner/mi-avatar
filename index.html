<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AI Avatar - V30 Synthetic Soul</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #overlay { position: absolute; inset: 0; pointer-events: none; 
                   background: radial-gradient(circle, transparent 30%, rgba(0,20,20,0.4) 100%); }
        canvas { width: 100vw; height: 100vh; transform: rotateY(180deg); }
        video { display: none; }
        #data-stream { position: absolute; bottom: 20px; right: 20px; color: #00ffcc; font-size: 10px; text-align: right; opacity: 0.5; line-height: 1.5; }
    </style>
</head>
<body>
    <div id="overlay"></div>
    <div id="data-stream">
        SIGNAL: ENCRYPTED<br>NODE: ACTIVE_V30<br>LATENCY: 14ms<br><span id="fps">0</span> FPS
    </div>

    <canvas id="out"></canvas>
    <video id="v" playsinline></video>

<script type="module">
    const video = document.getElementById('v');
    const canvas = document.getElementById('out');
    const ctx = canvas.getContext('2d');
    let lastTime = 0;

    function onResults(res) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Efecto de rastro (Motion Blur) para suavizar el movimiento
        ctx.fillStyle = "rgba(0, 0, 0, 0.15)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (res.multiFaceLandmarks && res.multiFaceLandmarks.length > 0) {
            const face = res.multiFaceLandmarks[0];

            // 1. MALLA DE PROFUNDIDAD (La esencia de la IA)
            // Dibujamos la tesselación con una línea casi invisible para dar textura
            ctx.globalCompositeOperation = "screen";
            drawConnectors(ctx, face, FACEMESH_TESSELATION, {
                color: "rgba(0, 255, 204, 0.08)",
                lineWidth: 0.5
            });

            // 2. ESTRUCTURA ÓPTICA (Contornos con Glow)
            ctx.shadowBlur = 12;
            ctx.shadowColor = "#00ffcc";
            
            // Ojos - Los hacemos más orgánicos y menos "puntos"
            [468, 473].forEach(idx => {
                const p = face[idx];
                const grad = ctx.createRadialGradient(p.x*canvas.width, p.y*canvas.height, 0, p.x*canvas.width, p.y*canvas.height, 8);
                grad.addColorStop(0, "#fff");
                grad.addColorStop(1, "rgba(0, 255, 204, 0)");
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(p.x*canvas.width, p.y*canvas.height, 8, 0, Math.PI*2);
                ctx.fill();
            });

            // Labios y Cejas (Líneas finas de datos)
            drawConnectors(ctx, face, FACEMESH_LIPS, {color: "rgba(255, 255, 255, 0.4)", lineWidth: 1});
            drawConnectors(ctx, face, FACEMESH_FACE_OVAL, {color: "rgba(0, 255, 204, 0.6)", lineWidth: 1.5});

            ctx.shadowBlur = 0;
            ctx.globalCompositeOperation = "source-over";
        }

        // Efecto de ruido digital estático
        if(Math.random() > 0.98) {
            ctx.fillStyle = "rgba(0, 255, 204, 0.05)";
            ctx.fillRect(0, Math.random()*canvas.height, canvas.width, 2);
        }

        const now = performance.now();
        document.getElementById('fps').innerText = Math.round(1000 / (now - lastTime));
        lastTime = now;
    }

    const faceMesh = new FaceMesh({
        locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
    });

    faceMesh.setOptions({
        maxNumFaces: 1,
        refineLandmarks: true,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
    });

    faceMesh.onResults(onResults);

    const camera = new Camera(video, {
        onFrame: async () => { await faceMesh.send({image: video}); },
        width: 1280, height: 720
    });
    camera.start();
</script>
</body>
</html>
